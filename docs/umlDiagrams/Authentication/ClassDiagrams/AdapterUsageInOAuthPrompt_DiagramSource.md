```mermaid
    graph LR
        BotEndpoint["#quot;api/messages#quot; endpoint in controller"] -- calls --> ProcessActivity["ProcessActivity()"] -- which creates --> TurnContext 
```

On `TurnContext` Initialization
```mermaid
    graph LR
        Adapter -- stored as member in --> TurnContext
```

`OAuthPrompt` has various methods* that uses `BotAdapter` within its logic:
```mermaid
    graph LR
    OAuthPrompt -- takes --> BotAdapter -. from .->  TurnContext
```
* `OAuthPrompt` methods that use `BotAdapter`: `BeginDialogAsync()`, `GetUserTokenAsync()`, `SignUserOutAsync()`, `SendOAuthCardAsync()`, `RecognizeTokenAsync()`

### **Class Diagrams of `OAuthPrompt` and Their Token Provider**
- [C#](#c-token-provider-in-oauthprompt)
- [JS](#js-token-provider-in-oauthprompt)

#### **C#: Token Provider in `OAuthPrompt`:**

`OAuthPrompt` uses a `BotFrameworkAdapter` that implements `ICredentialTokenProvider` to acquire tokens.

```mermaid
    classDiagram
        class OAuthPrompt

        class BotAdapter {
        }
        <<abstract>> BotAdapter

        class ICredentialTokenProvider {
            + GetUserTokenAsync()
            + GetOauthSignInLinkAsync()
            + SignOutUserAsync()
            + GetTokenStatusAsync()
            + GetAadTokenAsync()
        }
        <<Interface>> ICredentialTokenProvider

        TurnContext o-- BotAdapter: has a
        OAuthPrompt o-- ICredentialTokenProvider: uses as token provider
        BotAdapter <|-- BotFrameworkAdapter
        ICredentialTokenProvider <|-- BotFrameworkAdapter
        BotFrameworkAdapter --> OAuthClient : creates OAuthClient to get tokens
```

#### `OAuthClient` Class Diagram

```mermaid
    classDiagram
        class OAuthClient

        class ServiceClient {
        }
        <<abstract>> ServiceClient

        class IOAuthClient {
            + BaseUri
            + SerializationSettings
            + DeserializationSettings
            + Credentials
            + BotSignIn
            + UserToken
        }

        OAuthClient --|> ServiceClient: dervices from
        OAuthClient --|> IOAuthClient: implements
        IOAuthClient --|> IDisposable
```
* `ServiceClient` is an MS Rest class.

#### **JS: Token Provider in `OAuthPrompt`:**

`OAuthPrompt` uses a `BotFrameworkAdapter` that implements `ExtendedUserTokenProvider` to acquire tokens.

```mermaid
    classDiagram
        class OAuthPrompt

        class BotAdapter {
        }
        <<abstract>> BotAdapter

        class ExtendedUserTokenProvider {
            + getUserToken()
            + signOutUser()
            + getSignInLink()
            + getAadTokens()
            + getSignInResource()
            + exchangeToken()
        }

        TurnContext o-- BotAdapter: can have a
        OAuthPrompt o-- ExtendedUserTokenProvider: uses as token provider
        BotAdapter <|-- BotFrameworkAdapter
        ExtendedUserTokenProvider <|-- BotFrameworkAdapter
        BotFrameworkAdapter --> TokenApiClient : creates TokenApiClient to get tokens
```

#### `TokenApiClient` Class Diagram
```mermaid
    classDiagram
        class TokenApiClient {
            + botSignIn
            + userToken
        }

        class TokenApiClientContext {
            + baseUri
            + requestContentType
            + credentials
        }

        TokenApiClient --|> TokenApiClientContext: extends
        TokenApiClientContext --|> ServiceClient: extends
```

* `TokenApiClient` and `TokenApiClientContext` are classes generated by auto-rest.
* `ServiceClient` is an [msrest class](https://github.com/Azure/ms-rest-js/blob/master/lib/serviceClient.ts).